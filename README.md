# samba-smbd-3.x---4.x-exploit

For this second repository, I would like to gain access to a vulnerable in the Metasploitable called:

"Samba smbd 3.X - 4.X (workgroup: WORKGROUP)" it is a netbios-ssn service and it has two open ports (139/TCP and 445/TCP). 

This vulnerability is very easy to exploit. You just need to find the right exploit module to gain access. Fortunately, I will also be showing you additional information on how to find the full-service version name of the "netbios-ssn". Why? Well because as you can see "Samba smbd 3.X - 4.X" contains an unknown value. You can still exploit it without knowing the exact full version name but knowing how to find a full version name can be useful for some other situation.

Let us begin! 

------------------------------------------------------------------------------------------------------

Step 1: Using good old NMAP

Note: If you haven't look my very first repository, I will be using my Metasploitable machine. This means the IP address will be the Metasploitable machine itself. This can be different based on your target's IP address and situation. 

Here we will pay attention to these two highlighted open ports: 



![twoports](https://github.com/user-attachments/assets/07d7f78a-ec27-4616-a0e4-9062ff657df7)


In this case, we can choose whichever port we want either port 139 or 445. So we are going to choose the port 139. 


------------------------------------------------------------------------------------------------------------------------------

Step 2: Finding the full version name 


To find the full version name, we will have to use the Metasploit Framework in our Kali Linux. And then type "search smb" and press enter. The Metasploit Framework will then give you all the list  of modules. As shown below:


![metasploit 2](https://github.com/user-attachments/assets/12ce5a3e-3fd8-42bb-b0fc-29f920c72b07)

Now, what we want to do is to use an auxiliary module. From my understanding, the auxiliary module is a module where it can help you to get further information about your target and it can also be used for an attack. The only difference between the auxiliary module and the exploit module is that the auxiliary module does not require any payload to run the attack. A payload means something that you use for the attack. It can be malware for example. 

However, in this case, we are using the auxiliary module to conduct a scanning to find the version name. Therefore we must find the module called "auxiliary/scanner/smb/smb_version"


![auxiliary](https://github.com/user-attachments/assets/40cedd24-aa03-4848-b677-a174352fd2b8)


As you can see, it mentions "smb version detection" at the description. Therefore, this is what we need. Next, all you have to do is:

1) Copy the name of the module "auxiliary/scanner/smb/smb_version"
   
1a) It is recommended to clear the screen by typing "clear" so that things won't get messy. (OPTIONAL) 

2) Type "use" and then paste the module name that you copied "auxiliary/scanner/smb/smb_version"
   
3) Press enter 

![smb version](https://github.com/user-attachments/assets/68949ccb-2254-4a65-a6c7-fbbb827e22c7)

And that is how it is supposed to be.

Next, to know more about the information of the module, you can type "show info" and you will get the information that you need. 


![show info smb scan](https://github.com/user-attachments/assets/e5dae668-4007-4119-9b29-e8d7d26585a2)


To know what are the settings need to be set up you can type, "show options".


![show options scanner smb](https://github.com/user-attachments/assets/494e6f19-920f-4cac-894e-f974d116d3fa)

Here you only need to set up your target's IP address to the RHOSTS (Remote Host) selection. In this case, it will be my Metasploitable machine's IP address. 

type "set RHOSTS (your target's IP address)" and press enter

![RHOSTS auxliary](https://github.com/user-attachments/assets/0b0a60f1-f3b2-49db-af32-85e12e2e3854)


To see the updated setting that you made, you clear the screen and type "show options" and enter once again. 

![options 2](https://github.com/user-attachments/assets/5218f124-fbe4-4446-aa51-10cbe5720d37)


And as you can see the target's IP address is already set and ready.

What you want to do next is to run the module by typing "run" and enter. 

![version detected](https://github.com/user-attachments/assets/fe049d9d-c391-405c-b10d-10a85c5da41a)

Boom, the full-version name is detected "Samba 3.0.20-Debian" and now it's time to find the right exploit module to attack.


-----------------------------------------------------------------------------------------------------------------------------------

Step 3: Finding the right exploit module

We now know the actual version is "Samba 3.0.20-Debian" 

Let's find the exploit module by using this new information.

1) Copy "Samba 3.0.20"
2) Open a new terminal and type "searchsploit" and paste "Samba 3.0.20-Debian" and then enter.

Note: The searchsploit command with its access to the Exploit Database, is a powerful tool for discovering vulnerabilities and exploits.

![samba smb exploit module](https://github.com/user-attachments/assets/c8ffae1e-b06b-4a1a-bc0b-fc07ecfdea89)

We are going to use the "Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution (Metasploit)" because it has three reasons why.

First reason: It is run in Ruby programming language

Second reason: It is available within the Metasploit Framework

Third reason: It affects our version of Samba that we identified


What you want to do next is go back to the Metasploit Framework, and type "search samba". And look for the exploit that we found from the searchsploit earlier. 

Note: Remember and try to look for "'Username' map script'" to help you find in the Metasploit Framework

![usermap script samb](https://github.com/user-attachments/assets/76a9149f-4a8e-49e5-9e13-d04a4f7a516a)

And there we go! The exploit is there. As usual:

1) Copy the exploit module name
2) Type "use" and paste "exploit/multi/samba/usermap_script" and enter

--------------------------------------------------------------------------------------------------------------

Step 4: Preparing to attack

![RHOST samba](https://github.com/user-attachments/assets/5b3821b7-0d2a-4f87-956a-b6b607d55987)


Here you can see you are only required to set up your target's IP address. In fact, the target's port (RPORT) is automatically set as port 139. 

Remember that there are two open ports that are running the same version? Which are port 139 and port 445. So let's say you wanna change the port from 139 to port 445. All you have to do is:

1)type "set RPORT 445"

if you don't want to make any changes, you can let port 139 be. Other than that, let's set our RHOST. 

1) Type "set RHOSTS (your target's IP address)" and then press enter. 
2) Clear the screen.
3) Type "show options" again and enter.


![ready](https://github.com/user-attachments/assets/94e4a58c-8e93-4e28-a572-48bac422c8a6)

you are all ready now

----------------------------------------------------------------------------------------------

Step 5: ATTACK! 

Type "exploit" 

and.....

![samba success attack](https://github.com/user-attachments/assets/fd21c727-3cda-415c-bab4-f704861715bf)

You are now have gained access to the target's device through the vulnerability of port 139 which is running the Samba version. 

To check what is your level of permission and all the directories available:

Checking Level of Permission:
1) Type "whoami" and enter

![root](https://github.com/user-attachments/assets/87c84455-ac36-4dda-a023-d049b27b07de)

NOTE: Root is the most highest privileges or in other words, it is the highest permission access. And you can do whatever you want in the target's device. 

Checking all the directories
1) Type "ls" and enter

![directories](https://github.com/user-attachments/assets/b81fe9b8-0025-45a7-b16d-25b0131a3329)


Congratulations! The result is that we have successfully gained access to our target's IP address. 

REMINDER!: When doing penetration testing, all the vulnerabilities that you find, you must write it down in the report documentation. And you must not take any advantage of the data or any information. You must know your purpose.
